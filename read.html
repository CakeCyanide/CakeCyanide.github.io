<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>Chazel</title>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
	<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Poiret+One">
	<link rel="stylesheet" href="http://fonts.googleapis.com/earlyaccess/cwtexhei.css">
	<link rel="stylesheet" href="http://fonts.googleapis.com/earlyaccess/cwtexming.css">
	<link rel="stylesheet" href="./css/reset.css">
	<link rel="stylesheet" href="./css/style.css">
</head>

<body id="top">
<div id="goto-top">
	<a href="#top">Top</a>
</div>
<div id="outer-wrapper">
	<header>
		<div><!-- for flex layout -->
			<h1>Chazel</h1>
			<span>「我是塞車之神，你也是塞車之神，這座島上的所有人，都是塞車之神。」</span>
		</div>
	</header>
	<!-- end header -->

	<nav id="nav">
		<ul>
			<li><a href="#novel">長篇小說 - 泣城</a></li>
			<li><a href="#short-story">短篇小說</a></li>
			<li><a href="#flash-fiction">極短篇小說</a></li>
		</ul>
	</nav>
	<!-- end nav -->

	<nav id="nav-fixed">
		<span>Chazel</span>
		<ul>
			<li><a href="#short-story">返回目錄</a></li>
			<li><a href="#novel">上一回：title</a></li>
			<li><a href="#flash-fiction">下一回：title</a></li>
		</ul>
	</nav>
	<!-- end nav-fixed -->

	<div id="main-wrapper">
		<section id="reading" class="no-border">
			<h2>泣城 - 豢養之章(完)</h2>
			<button id="chapter-1-tab" class="btn">上一回：啊哈哈哈</button>
			<button id="chapter-2-tab" class="btn">下一回：呼呼呼</button>
			<button id="chapter-3-tab" class="btn">其他章節</button>
			<div id="reading-content">　　媽的。<br>　　搞什麼。<br>　　腐臭水花在身下的爛泥之上朵朵綻放，腳踝和腳底板痛得要命，大概是斷了或碎了。腰也是，肩膀也是。<br>　　沒想到幾個小時之內，什麼都沒了。<br>　　黎、編號２２８、照護所、我僅存的一切。<br>　　落下的雨水不由分說滑進了嘴裡，無法形容的酸臭霎時充滿口腔，胃液自喉嚨底部湧上，灼熱食道，灌入鼻腔。<br>　　我不由自主拱起身子，側躺在地又咳又吐，嘔吐物摻或雨水在爛泥中擴散，沾滿工作服，還有口袋中碎裂成數百片的玻璃瓶碎片。<br>　　媽的，溼答答的。<br>　　血、胃液、泥水、雨、口水、眼淚、尿液、汗水。<br>　　所有一切都亂七八糟，濕漉漉的，媽的，為什麼要這樣？為什麼會這樣？<br>　　我能模糊地看見拳頭上插了些細玻璃，因雙手緊握而顫抖著，我應該先離開這裡吧？先離開這裡嗎？能離開這裡嗎？能離開這裡吧？<br>　　全身又痛又辣，可下半身不太能施力，連起身也無法，這可不行，我還得回去救……誰？<br>　　「我要。」「沒關係，盡情地哭吧，我不會丟下妳不管的。」「雖然徒弟必須要遵守師父說的話，但是別太勉強。」「病患的健康為我的首要顧念。」「我才沒有哭勒！」「臺北啊……說到這城市，我啊，還滿喜歡香菇的。」「問你身體還好嗎？」「我有產生一點異變，不過，所有人都是受害者吧？」「沖水了，可能會有點冷，忍耐一下。」「你到底知不知道……」「逃！」<br>　　啪。<br>　　身體因雙臂到達極限、無法支撐而落地，媽的，我恨透了這世界，恨透了這絲毫沒有憐憫之意的滂沱雨水。<br>　　我可以放棄了吧？<br>　　什麼都不重要了吧？<br>　　靠近圍牆旁的草叢堆似乎有些動靜，大概是餓上了好幾天的野狗準備獵食了，媽的，就來吧。<br>　　我又堅持了幾秒，果不其然，草叢中竄出了兩條狗，一條長吻一條短吻，手臂上似乎還刺上了「獫猲」兩字，等等，狗的手臂……？<br>　　一片漆黑。<br>　　我不知道。<br>　　隨便。<br>　　就這樣了吧。<br>　　再見，這惹人厭的城市。</div>
		</section>
	</div>
	<!-- end main-wrapper -->
</div>
<!-- end outer-wrapper -->

<footer>
	<div id="footer-wrapper">
		<span>關於我們</span>
		<div class="footer-col">
			<img src="./img/footer/chazel.jpg">
			<div>
				<span class="name">陳建佐 Chazel</span>
				<span class="description">some text</span>
			</div>
		</div>
		<div class="footer-col">
			<img src="./img/footer/ryan.jpg">
			<div>
				<span class="name">陳柏翰 Ryan</span>
				<span class="description">some text</span>
			</div>
		</div>
		<div style="clear: both;"></div>
	</div>
</footer>

<script>
/*
 * config
 */
var novelArticleNum = [21, 9];
var shortStoryArticleNum = 2;
var flashFictionArticleNum = 4;

var novelChapterNum = novelArticleNum.length;
var shortStoryPageNum = Math.ceil(shortStoryArticleNum / 3);
var flashFictionPageNum = Math.ceil(flashFictionArticleNum / 3);


/*
 * smooth scrolling
 */
$(function() {
	$('a[href*=#]:not([href=#])').click(function() {
		if(location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'') && location.hostname == this.hostname) {
			var target = $(this.hash);
			target = target.length ? target : $('[name=' + this.hash.slice(1) +']');
			if (target.length) {
				$('html,body').animate({scrollTop: target.offset().top - 80}, 800);
        		return false;
        	}
        }
    });
});


/*
 * nav display
 */
var nav = document.getElementById("nav");
var navFixed = document.getElementById("nav-fixed");

function handleNav() {
	if(nav.getBoundingClientRect().top < -50) {
		navFixed.style.transition = "top 0s, opacity 0.5s";
		navFixed.style.top = "0";
		navFixed.style.opacity = 1;
	}
	else {
		navFixed.style.transition = "top 0s 0.5s, opacity 0.5s"; //top delay 0.5s
		navFixed.style.top = "-9999px";
		navFixed.style.opacity = 0;
	}
}
window.addEventListener("scroll", function(){handleNav(); }, false);


/*
 * active tab
 */
function activeTab(chapter) {
	//tab
	for(var i = 1; i <= novelChapterNum; i++) {
		var tab = document.getElementById("chapter-" + i + "-tab");
		tab.className = tab.className.replace(/ btn-active/g, "");
	}
	document.getElementById("chapter-" + chapter + "-tab").className += " btn-active";
	//content
	loadNovel(chapter);
}


/*
 * AJAX
 */
$.ajaxSetup({cache: false }); //not sure whether it will work

function loadSummary(section, page) {
	var articleNum, pageNum;
	if(section == "short-story") {
		articleNum = shortStoryArticleNum;
		pageNum = shortStoryPageNum;
	}
	else if(section == "flash-fiction") {
		articleNum = flashFictionArticleNum;
		pageNum = flashFictionPageNum;
	}
	for(var p = 1; p <= pageNum; p++)
		$("#" + section + "-paging-btn-" + p).removeClass("btn-active");
	$("#" + section + "-paging-btn-" + page).addClass("btn-active");

	for(var col = 1; col <= 3; col++) {
		var articleID = articleNum - 3 * (page - 1) - col + 1;
		if(articleID <= 0) {
			for(var i = col; i <= 3; i++) {
				deployArticle(section, i, 0);
			}
			break;
		}
		deployArticle(section, col, articleID);
	}
}

function deployArticle(section, col, articleID) {
	//leave empty
	if(articleID == 0) {
		$("#" + section + "-" + col + "-cover").css("background-image", "none");
		$("#" + section + "-" + col + "-category").html("");
		$("#" + section + "-" + col + "-title").html("");
		$("#" + section + "-" + col + "-content").html("");
		return;
	}

	$.get("http://cakecyanide.github.io/text/" + section + "/" + articleID, function(data) {
		var a = data.split("\n");
		//load cover
		$("#" + section + "-" + col + "-cover").css({
			background: "url('./img/cover/" + section + "/" + a[0] + "') center center",
			backgroundSize: "cover"
		});
		//load article
		if(section == "short-story")
			$("#" + section + "-" + col + "-category").html("短篇小說");
		else if(section == "flash-fiction")
			$("#" + section + "-" + col + "-category").html("極短篇小說");
		$("#" + section + "-" + col + "-title").html(a[1]);
		$("#" + section + "-" + col + "-content").html(a[2].replace(/<br>/g, "").replace(/　/g, "").substring(0, 120) + "...");
	});
}

function deployPagingBtn(section) {
	var pageNum;
	if(section == "short-story")
		pageNum = shortStoryPageNum;
	else if(section == "flash-fiction")
		pageNum = flashFictionPageNum;

	var output = ["<button id=\"" + section + "-paging-btn-1\"class=\"btn\" onclick=\"loadSummary('" + section + "', 1)\">1</button>"];
	for(var page = 2; page <= pageNum; page++)
		output.push("<button id=\"" + section + "-paging-btn-" + page + "\" class=\"btn\" onclick=\"loadSummary('" + section + "', " + page + ")\">" + page + "</button>");
	$("#" + section + "-paging").html(output.join(""));
}


loadNovel(novelChapterNum);
loadSummary("short-story", 1);
deployPagingBtn("short-story");
loadSummary("flash-fiction", 1);
deployPagingBtn("flash-fiction");
</script>
</body>
</html>